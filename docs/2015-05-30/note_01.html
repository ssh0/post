<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>コマンドラインで動かすファイルマネージャrangerの設定</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="/home/shotaro/Workspace/blog/styles/stylesheet.css">
</head>
<body>
<div id="main_content_wrap" class="outer">
<section id="main_content" class="inner">
<header>
<h1 class="title">コマンドラインで動かすファイルマネージャrangerの設定</h1>
</header>
<div align="right">
<p>
2015-05-30
</p>
</div>

<p>LinuxもしくはMacで使うことの出来る、CLIファイルマネージャである<a href="http://ranger.nongnu.org/">ranger</a>の紹介と、使いやすくする設定を紹介します。</p>
<p><img src="screen_007.jpg" alt="screen_007.jpg" /> <img src="screen_005.jpg" alt="screen_005.jpg" /> <img src="screen_006.jpg" alt="screen_006.jpg" /></p>
<p>まず、rangerそのものについてですが、vimライクなキーアサインでも動かすことができ、設定ファイルも読みやすく、挙動も安定しているので、CLIで動くファイルマネージャを探しているのなら、迷わずこれでいいと思います。なにより軽いので、GUIでファイルマネージャを使うよりは軽快で、一度このスピードになれてしまうと、もう戻れない感覚だと思います。</p>
<p>詳細な説明については、rangerの<a href="https://github.com/hut/ranger/wiki">Wiki</a>を見てもらうか、英語ですが以下の動画を見てもらえば分かるのではないかと思います。以下では、個人的に便利だと感じた使い方と、設定について述べていこうと思います。</p>
<ul>
<li><p><a href="https://www.youtube.com/watch?v=qooLR8NmYKs">Ranger - Console File Manager - Linux TUI - YouTube</a><br /><a href="https://www.youtube.com/watch?v=qooLR8NmYKs"><img src="http://img.youtube.com/vi/qooLR8NmYKs/2.jpg" alt="Ranger - Console File Manager - Linux TUI - YouTube [Ranger - Console File Manager - Linux TUI - YouTube]" /></a></p></li>
<li><p><a href="http://ranger.nongnu.org/screenshots.html">ranger screenshots</a></p></li>
</ul>
<h2 id="基本のキーアサイン">基本のキーアサイン</h2>
<p>以下に基本的なキーアサインを書いておきます。これだけ押さえていれば、大体普通の作業をするのには困らないと思います。とってもVim的なキーバインドなので、慣れている人であれば、すぐに使えるようになると思います。</p>
<table>
<col style="width: 30%" /><col style="width: 69%" /><thead>
<tr class="header">
<th style="text-align: left;">command</th>
<th style="text-align: left;">操作</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><p><code>h,j,k,l</code> or 矢印キー</p></td>
<td style="text-align: left;"><p>上下左右移動</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>r</code></p></td>
<td style="text-align: left;"><p>起動するアプリケーションを指定</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p>Space</p></td>
<td style="text-align: left;"><p>ファイルを選択</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>v</code></p></td>
<td style="text-align: left;"><p>すべて選択</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>V</code></p></td>
<td style="text-align: left;"><p>選択モード(範囲選択)</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>y&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>yank &amp; 何か操作</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>yy</code></p></td>
<td style="text-align: left;"><p>選択されているファイルをコピー</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>yp</code></p></td>
<td style="text-align: left;"><p>選択されているファイルのフルパスをコピー(xselが必要)</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>d&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>cut &amp; 何か操作</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>dd</code></p></td>
<td style="text-align: left;"><p>選択されたファイルを切り取り</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>p&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>貼り付け + オプション</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>pp</code></p></td>
<td style="text-align: left;"><p>切り取り、コピーしたファイルを貼り付け</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p>Delete</p></td>
<td style="text-align: left;"><p>削除(rm)</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>g&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p><code>&lt;char&gt;</code>で指定された動きをする</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>gn</code> or Ctrl+<code>n</code></p></td>
<td style="text-align: left;"><p>新しいタブを開く</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>gc</code> or Ctrl+<code>w</code></p></td>
<td style="text-align: left;"><p>タブを閉じる</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>gt</code> or Ctrl+Tab</p></td>
<td style="text-align: left;"><p>次のタブへ移動</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>gT</code> or Ctrl+Shift+Tab</p></td>
<td style="text-align: left;"><p>前のタブへ移動</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p>Alt+<code>&lt;n&gt;</code></p></td>
<td style="text-align: left;"><p>番号<code>&lt;n&gt;</code>のタブへ移動</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>z&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>オプションのトグル</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>zh</code></p></td>
<td style="text-align: left;"><p>隠しファイルの表示/非表示のトグル</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>m&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>現在のディレクトリを<code>&lt;char&gt;</code>キーでブックマーク</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>`&lt;char&gt;</code></p></td>
<td style="text-align: left;"><p>ブックマークされたディレクトリに飛ぶ</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>`</code> `</p></td>
<td style="text-align: left;"><p>最近開いたディレクトリに飛ぶ</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>cw</code></p></td>
<td style="text-align: left;"><p>ファイル名を編集</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>A</code></p></td>
<td style="text-align: left;"><p>ファイル名を編集(現在のファイル名が入った状態)</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>/</code></p></td>
<td style="text-align: left;"><p>インクリメンタルサーチ</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>S</code></p></td>
<td style="text-align: left;"><p>現在のディレクトリでサブシェルに入る</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>:</code></p></td>
<td style="text-align: left;"><p>コマンド入力モードに入る(Ctrl+<code>c</code>で抜ける)</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>!</code></p></td>
<td style="text-align: left;"><p>現在のディレクトリでシェルコマンドを実行する</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>q</code></p></td>
<td style="text-align: left;"><p>rangerを終了</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>?</code></p></td>
<td style="text-align: left;"><p>マニュアルを表示</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>1?</code></p></td>
<td style="text-align: left;"><p>キーバインディングを表示</p></td>
</tr>
<tr class="even">
<td style="text-align: left;"><p><code>2?</code></p></td>
<td style="text-align: left;"><p>コマンドのヘルプを表示</p></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><p><code>3?</code></p></td>
<td style="text-align: left;"><p>現在の設定値を表示</p></td>
</tr>
</tbody>
</table>
<h2 id="設定ファイル">設定ファイル</h2>
<p>rangerの設定ファイルは、Linuxなら<code>~/.config/ranger</code>以下にあります。</p>
<figure>
<img src="screen_001.jpg" alt="screen_001.jpg" /><figcaption>screen_001.jpg</figcaption>
</figure>
<p>rc.confではオプションとキーバインディングを、rifle.confでは、各ファイルタイプについて、どのプログラムを用いて開くかを設定できます。元々の設定ファイルがよく書かれているので、ある程度英語が読めれば、簡単に設定が出来ると思います。</p>
<p>scope.shでは、</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co"># ranger supports enhanced previews.  If the option &quot;use_preview_script&quot;</span>
<span class="co"># is set to True and this file exists, this script will be called and its</span>
<span class="co"># output is displayed in ranger.  ANSI color codes are supported.</span></code></pre>
<p>とあるように、オプションでプレビュー表示をオンにしたとき(<code>set preview_files true</code>)に、ファイルタイプにあわせてどのようなプログラムを使ってプレビュー表示をさせるかを設定することができます。</p>
<p>また、colorscheme以下に自分で定義したカラースキームを置き、モジュールとして読み込むようにしてあげると、カラースキームを変更することができます。デフォルトでは“default”,“jungle”,“snow”が使えます。</p>
<p>自分の設定ファイル晒しときますね。</p>
<ul>
<li><a href="https://github.com/ssh0/dotfiles/tree/master/ranger">dotfiles/ranger at master · ssh0/dotfiles</a></li>
</ul>
<h2 id="rangerに関連して設定しておくといいもの">rangerに関連して設定しておくといいもの</h2>
<p>rangerを使っていると、cdコマンドを使って移動するより断然早くディレクトリ間を移動できるので、どんどん<code>S</code>でシェルで抜けてまたrangerを開いて・・・としていくことになるかと思います。さて、一段落したので端末を閉じましょう、というときに、<code>exit</code>とすると、rangerが立ち上がります。！？となるかもしれませんが、<code>S</code>はサブシェルを開いてその中で作業するものなので、気がついたらどんどんネストしていた、という自体に簡単に陥ります。これを解決する簡単な方法は、<code>~/.zshrc</code>などに、以下のように関数を登録しておくことです。(<a href="https://wiki.archlinux.org/index.php/Ranger#Start_new_ranger_instance_only_if_it.27s_not_running_in_current_shell">Start new ranger instance only if it’s not running in current shell</a>)</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">function</span><span class="fu"> r()</span> <span class="kw">{</span>
    <span class="kw">if [</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="ot">$RANGER_LEVEL</span><span class="st">&quot;</span><span class="kw"> ]</span>; <span class="kw">then</span>
        <span class="kw">ranger</span> <span class="ot">$@</span>
    <span class="kw">else</span>
        <span class="kw">exit</span>
    <span class="kw">fi</span>
<span class="kw">}</span></code></pre>
<p>rangerはサブシェルを立ち上げるときに環境変数<code>$RANGER_LEVEL</code>にゼロでない値を入れていくので、これによって既にサブシェルの中にいるときに<code>r</code>でranegrを起動しようとしたときには一回そのサブシェルを閉じることでrangerの画面に戻るようにしたものが上のスクリプトの意味するところです。</p>
<p>また、これと全く同じように、自分が今サブシェルにいるかどうかを判定することができるので、promptの情報としてこれを表示させれば便利ですね。以下の情報はかなり偏ったものですので飛ばして頂いても構いません。zsh以外のシェルやテーマを使っている方にとっても参考になればいいんですが。</p>
<p>僕はoh-my-zshのagnosterテーマを改変して使っているので、その中で</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">prompt_ranger()</span> <span class="kw">{</span>
  <span class="kw">if [[</span> <span class="ot">-n</span> <span class="ot">${RANGER_LEVEL}</span><span class="kw"> ]]</span>; <span class="kw">then</span>
    <span class="kw">prompt_segment</span> 236 blue <span class="st">&quot;®&quot;</span>
  <span class="kw">fi</span>
<span class="kw">}</span></code></pre>
<p>としてプロンプトを表示する部分を定義しておいて、</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## Main prompt</span>
<span class="fu">build_prompt()</span> <span class="kw">{</span>
  <span class="ot">RETVAL=$?</span>
  <span class="kw">prompt_status</span>
  <span class="kw">prompt_virtualenv</span>
  <span class="kw">prompt_context</span>
  <span class="kw">prompt_dir</span>
  <span class="kw">prompt_git</span>
  <span class="kw">prompt_ranger</span> <span class="co"># &lt;&lt;&lt;</span>
  <span class="kw">prompt_hg</span>
  <span class="kw">prompt_end</span>
<span class="kw">}</span></code></pre>
<p>として反映させれば、サブシェル以下にいないときは</p>
<figure>
<img src="screen_002.jpg" alt="screen_002.jpg" /><figcaption>screen_002.jpg</figcaption>
</figure>
<p>のように表示されるのに対し、rangerから<code>S</code>で抜けた後は</p>
<figure>
<img src="screen_003.jpg" alt="screen_003.jpg" /><figcaption>screen_003.jpg</figcaption>
</figure>
<p>プロンプトが表示されて、今自分がrangerの作ったサブシェルの中にいることが見て分かるようになります。</p>
<h2 id="まとめ">まとめ</h2>
<p>以上、簡単ですがCLIファイルマネージャrangerの紹介と、その設定についてまとめました。ターミナル上で動かすことのメリットはたくさんあると思うので、ちょっとした日々の操作にも、ぜひ使ってみるといいと思います。皆さんのコマンドライン生活が豊かになりますように！</p>
</section>
</div>
</body>
</html>
